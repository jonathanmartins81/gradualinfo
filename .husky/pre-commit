#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Cores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

echo "${BLUE}ğŸš€ Aqua9 Boilerplate v2 - Pre-commit Hook${NC}"
echo "${CYAN}==========================================${NC}"

# FunÃ§Ã£o para exibir status
show_status() {
    if [ $? -eq 0 ]; then
        echo "${GREEN}âœ… $1${NC}"
    else
        echo "${RED}âŒ $1${NC}"
        exit 1
    fi
}

# FunÃ§Ã£o para exibir progresso
show_progress() {
    echo "${YELLOW}ğŸ”„ $1...${NC}"
}

# 1. Lint-staged (formatar e lintar arquivos alterados)
show_progress "Formatando e lintando arquivos alterados"
npx --no-install lint-staged
show_status "Lint-staged executado"

# 2. VerificaÃ§Ã£o de tipos TypeScript
show_progress "Verificando tipos TypeScript"
npm run type-check > /dev/null 2>&1
show_status "TypeScript type-check"

# 3. Testes unitÃ¡rios com Vitest (OBRIGATÃ“RIO para todos os commits)
show_progress "Executando testes unitÃ¡rios (OBRIGATÃ“RIO)"
npx vitest run --reporter=verbose --run --coverage=false
show_status "Testes unitÃ¡rios"

# 4. VerificaÃ§Ã£o de qualidade geral
show_progress "Verificando qualidade geral do cÃ³digo"
npm run lint > /dev/null 2>&1 && npm run format:check > /dev/null 2>&1
show_status "Qualidade geral do cÃ³digo"

# 5. VerificaÃ§Ã£o de dependÃªncias (opcional, comentado para desenvolvimento)
# show_progress "Verificando dependÃªncias"
# npm run check-deps > /dev/null 2>&1
# show_status "VerificaÃ§Ã£o de dependÃªncias"

echo ""
echo "${GREEN}ğŸ‰ Pre-commit hook executado com sucesso!${NC}"
echo "${CYAN}ğŸ“ Commit permitido.${NC}"
echo ""
echo "${YELLOW}ğŸ’¡ Dicas:${NC}"
echo "   â€¢ Para verificaÃ§Ã£o completa: ${PURPLE}npm run quality${NC}"
echo "   â€¢ Para verificar dependÃªncias: ${PURPLE}npm run check-deps${NC}"
echo "   â€¢ Para testes com cobertura: ${PURPLE}npm run test:coverage${NC}"
echo "   â€¢ Para testes E2E: ${PURPLE}npm run test:e2e${NC}"
echo ""
echo "${BLUE}ğŸ”— RepositÃ³rio: https://github.com/jonathanmartins81/boilerplate_aqua9_v2${NC}"
